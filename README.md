# Slice Function Demo - PLYファイル3Dスライスビューワー

WebベースのPLYファイル3Dビューワーです。直感的な箱型マニピュレーターを使用してXYZ軸でのスライス（トリミング）機能を提供します。

## 機能

### 基本機能
- **PLYファイル読み込み**: ASCII/Binary両対応、ドラッグ&ドロップまたはファイル選択
- **3Dモデル表示**: ポイントクラウド表示
- **3Dナビゲーション**: マウスでの回転、ズーム、パン操作
- **天球表示**: 背景に天球画像を表示
- **グリッド表示**: モデル下部にグリッドを自動表示

### スライス機能
- **箱型マニピュレーター**: 3D空間での直感的なスライス範囲設定
  - 面ハンドル: 単軸移動
  - エッジハンドル: 二軸同時移動（回転対応）
  - 頂点ハンドル: 三軸同時移動（対角基点変形）
- **リアルタイムプレビュー**: スライス範囲外を20%透明で表示、範囲内の境界点群を白色で強調表示
- **スライス実行**: 範囲外の頂点を完全除去、境界点群を白色で表示
- **全範囲スライス**: モデル全体を囲むスライスボックスを自動設定

### 向き調整機能
- **プリセット視点**: 正面、上面、側面、等角視点への切り替え
- **回転操作**: X/Y/Z軸での90度回転
- **反転操作**: X/Y/Z軸での180度反転

### ビューモード
- **3Dモード**: 標準的な3Dビューモード
- **ウォークスルーモード**: ウォークスルー用ビューモード（将来実装予定）

### ビューコントロール
- **Orbit**: オービットコントロール
- **Look**: カメラが常にモデルを見るモード
- **Third**: サードパーソンビュー（将来実装予定）

## 使用方法

1. **ファイル読み込み**
   - PLYファイルをドラッグ&ドロップ
   - またはドロップゾーンをクリックしてファイル選択
   - デフォルトPLYファイル（`Scaniverse 2024-07-21 155128.ply`）が自動読み込みされます

2. **スライス操作**
   - 右下の「スライス」ボタンをクリックしてスライスモードに入る
   - 箱型マニピュレーターのハンドルをドラッグして範囲調整
   - オプションパネルで「外側の点群を表示する」を切り替え可能
   - 「完了する」ボタンでスライスを実行
   - 「編集する」ボタンでスライス範囲を再調整可能
   - 「全範囲を表示する」ボタンでモデル全体を囲むスライスボックスを設定

3. **向き調整**
   - モデル読み込み後、向き調整モーダルが表示される場合があります
   - プリセットボタンまたは回転ボタンで向きを調整
   - 「この向きで確定」ボタンで確定

4. **リセット**
   - 「編集する」ボタンでスライス前の状態に戻す
   - スライス解除モーダルでスライスを完全に解除

## 操作方法

### 3Dナビゲーション
- **回転**: 左クリックドラッグ
- **ズーム**: マウスホイール
- **パン**: 右クリックドラッグ

### マニピュレーター操作
- **面ハンドル**: 単一軸方向に移動
- **エッジハンドル**: 2軸同時移動、回転操作可能
- **頂点ハンドル**: 3軸同時移動、対角基点変形
- **Escキー**: スライス操作をキャンセル

## 技術仕様

### 対応ブラウザ
- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

### ファイル制限
- 最大ファイルサイズ: 100MB
- 推奨頂点数: 100万以下

### 技術スタック
- **Three.js r160**: 3Dレンダリング
- **HTML5/CSS3**: UI
- **ES6 Modules**: モジュール化されたアプリケーションロジック

## ファイル構成

```
Slice01/
├── index.html              # メインHTML
├── app.js                  # メインアプリケーションエントリーポイント
├── css/
│   └── styles.css         # スタイルシート
├── js/
│   ├── PLYViewer.js       # メインPLYビューワークラス
│   ├── TrimBoxManipulator.js  # スライス箱マニピュレーター
│   ├── RealtimePreview.js     # リアルタイムプレビュー
│   └── TabManager.js          # タブ管理（将来実装予定）
├── assets/                # UIアイコン（SVG）
├── OBJ/                   # OBJ形式の3Dモデル（マニピュレーター用）
├── pic/                   # 天球画像
├── Scaniverse 2024-07-21 155128.ply  # デフォルトPLYファイル
└── README.md              # このファイル
```

## 起動方法

1. プロジェクトディレクトリで以下を実行:
```bash
# Python 3を使用する場合
python -m http.server 8000

# Node.jsのhttp-serverを使用する場合
npx http-server

# PHPを使用する場合
php -S localhost:8000
```

2. ブラウザで http://localhost:8000 にアクセス

## 注意事項

- WebGLに対応したブラウザが必要です
- 大容量のPLYファイルは読み込みに時間がかかる場合があります
- メモリ使用量が多いため、4GB以上のRAMを推奨します
- CORS制限があるため、ローカルサーバー経由でアクセスしてください